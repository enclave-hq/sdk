# ZKPay SDK Complete Guide

## üèóÔ∏è System Architecture

```
ZKPay SDK
‚îú‚îÄ‚îÄ ZKPayClient (Main Client)
‚îú‚îÄ‚îÄ WalletManager (Wallet Management - One private key corresponds to one wallet instance)
‚îú‚îÄ‚îÄ DepositManager (Deposit Management)
‚îú‚îÄ‚îÄ CommitmentManager (Commitment Management)
‚îî‚îÄ‚îÄ WithdrawManager (Withdrawal Management)
```

## üéØ Core Features

| Feature                    | API Method                                          | Sync/Async | Description                               |
| -------------------------- | --------------------------------------------------- | ---------- | ----------------------------------------- |
| 1. Backend Login           | `login(privateKey)`                                 | Sync       | Login authentication using private key    |
| 2. Approve and Deposit     | `deposit(chainId, tokenSymbol, amount)`             | Sync       | Automatically handle approval and deposit |
| 3. Read CheckBook          | `getUserDeposits()`                                 | Sync       | Get user's deposit records                |
| 4. Create Allocation+Sign  | `createAllocationAndSign(checkbookId, allocations)` | Sync       | Create allocation plan and sign           |
| 5. Execute Commitment      | `executeCommitmentSync()`                           | Sync       | Wait until with_checkbook status          |
| 5. Execute Commitment      | `executeCommitmentAsync()`                          | Async      | Return immediately, provide monitoring    |
| 6. Generate Withdraw Proof | `generateProofSync()`                               | Sync       | Wait until completed status               |
| 6. Generate Withdraw Proof | `generateProofAsync()`                              | Async      | Return immediately, provide monitoring    |

## üîÑ Complete Business Flow

### 1. Initialization and Authentication

```javascript
const { ZKPayClient } = require("./core/zkpay-client-library");
const client = new ZKPayClient(config, logger);
await client.initialize();

// Method 1: Login with private key
await client.login(privateKey);

// Method 2: Login with KMS signer
const kmsSigner = new ZKPayKMSSigner(kmsConfig);
await client.loginWithSigner(kmsSigner, userAddress);
```

### API Flow Overview

ZKPay's complete API flow includes the following key steps:

```
1. Auth Login ‚Üí 2. Deposit Detection ‚Üí 3. Commitment Allocation ‚Üí 4. Proof Generation ‚Üí 5. Withdrawal Complete
     ‚Üì              ‚Üì                    ‚Üì                      ‚Üì                    ‚Üì
  Backend Login   Detect On-chain Tx   Create Allocation Sign   Generate ZK Proof   Execute On-chain Withdrawal
```

#### Detailed API Call Flow

**Phase 1: Initialization and Authentication**

```javascript
// 1.1 Initialize client
await client.initialize();

// 1.2 User authentication (choose one)
await client.login(privateKey); // Direct private key login
// or
await client.loginWithSigner(kmsSigner, userAddress); // KMS signer login
```

**Phase 2: Deposit Operations**

```javascript
// 2.1 Check token balance and allowance
const balance = await client.checkTokenBalance(chainId, tokenAddress);
const allowance = await client.checkTokenAllowance(
  chainId,
  tokenAddress,
  treasuryAddress
);

// 2.2 Approve token (if needed)
if (allowance.balance < requiredAmount) {
  await client.approveToken(chainId, tokenAddress, amount, treasuryAddress);
}

// 2.3 Execute deposit
const depositResult = await client.deposit(
  chainId,
  tokenAddress,
  amount,
  treasuryAddress
);

// 2.4 Wait for backend deposit detection
const depositRecord = await client.waitForDepositDetection(
  depositResult.txHash,
  chainId,
  60
);
```

**Phase 3: Commitment Allocation**

```javascript
// 3.1 Create allocation plan
const allocations = [
  {
    recipient_chain_id: targetChainId,
    recipient_address: recipientAddress,
    amount: amountInWei,
  },
];

// 3.2 Execute commitment (sync or async)
const commitmentResult = await client.executeCommitmentSync(
  depositRecord.checkbookId,
  allocations,
  true
);
```

**Phase 4: Proof Generation**

```javascript
// 4.1 Prepare withdrawal information
const recipientInfo = {
  chain_id: targetChainId,
  address: recipientAddress,
  amount: amountInWei,
  token_symbol: tokenSymbol,
};

// 4.2 Generate withdrawal proof (sync or async)
const proofResult = await client.generateProofSync(
  depositRecord.checkbookId,
  recipientInfo,
  true
);
```

**Phase 5: Status Monitoring**

```javascript
// 5.1 Monitor commitment status
await client.waitForCommitmentStatus(checkbookId, ["with_checkbook"], 300);

// 5.2 Monitor proof generation status
await client.waitForProofStatus(checkId, ["completed"], 300);
```

### 2. Deposit

```javascript
// Define necessary addresses and parameters
const testUsdtAddress = "0xbFBD79DbF5369D013a3D31812F67784efa6e0309";
const treasuryAddress = "0x83DCC14c8d40B87DE01cC641b655bD608cf537e8";
const amount = "10.0";

// Get token information (including decimals)
const tokenInfo = await client.getTokenInfo(714, testUsdtAddress);
console.log(
  `Token: ${tokenInfo.symbol} (${tokenInfo.name}) - ${tokenInfo.decimals} decimals`
);

// Check balance and allowance (using token address)
const balance = await client.checkTokenBalance(714, testUsdtAddress);
const allowance = await client.checkTokenAllowance(
  714,
  testUsdtAddress,
  treasuryAddress
);

// Approve token (using token address and dynamic decimals)
if (allowance.balance < ethers.parseUnits(amount, tokenInfo.decimals)) {
  await client.approveToken(714, testUsdtAddress, amount, treasuryAddress);
}

// Execute deposit (using token address)
const depositResult = await client.deposit(
  714,
  testUsdtAddress,
  amount,
  treasuryAddress
);
const depositRecord = await client.waitForDepositDetection(
  depositResult.txHash,
  714,
  60
);
```

### 3. Commitment

```javascript
// Create allocation plan
const allocations = [
  {
    recipient_chain_id: 714,
    recipient_address: "0xRecipientAddress",
    amount: "10000000000000000000", // 10.0 USDT
  },
];

// Execute commitment
const commitmentResult = await client.executeCommitmentSync(
  depositRecord.checkbookId,
  allocations,
  true
);
```

### 4. Withdrawal

```javascript
// Prepare recipient information
const recipientInfo = {
  chain_id: 714,
  address: "0xRecipientAddress",
  amount: "10000000000000000000",
  token_symbol: "test_usdt",
};

// Generate withdrawal proof
const withdrawResult = await client.generateProofSync(
  depositRecord.checkbookId,
  recipientInfo,
  true
);
```

## üöÄ Usage Methods

### Method 1: Step-by-Step Execution

```javascript
async function stepByStepFlow() {
  const client = new ZKPayClient(config, logger);
  await client.initialize();
  await client.login(privateKey);

  // Define necessary addresses and parameters
  const testUsdtAddress = "0xbFBD79DbF5369D013a3D31812F67784efa6e0309";
  const treasuryAddress = "0x83DCC14c8d40B87DE01cC641b655bD608cf537e8";
  const amount = "10.0";

  // Get token information (including decimals)
  const tokenInfo = await client.getTokenInfo(714, testUsdtAddress);
  console.log(
    `Token: ${tokenInfo.symbol} (${tokenInfo.name}) - ${tokenInfo.decimals} decimals`
  );

  // Check balance and allowance (using token address)
  const balance = await client.checkTokenBalance(714, testUsdtAddress);
  const allowance = await client.checkTokenAllowance(
    714,
    testUsdtAddress,
    treasuryAddress
  );

  // Approve token (if needed, using token address and dynamic decimals)
  if (allowance.balance < ethers.parseUnits(amount, tokenInfo.decimals)) {
    await client.approveToken(714, testUsdtAddress, amount, treasuryAddress);
  }

  // Deposit (using token address)
  const depositResult = await client.deposit(
    714,
    testUsdtAddress,
    amount,
    treasuryAddress
  );
  const depositRecord = await client.waitForDepositDetection(
    depositResult.txHash,
    714,
    60
  );

  // Commitment
  const allocations = [
    {
      recipient_chain_id: 714,
      recipient_address: "0xRecipientAddress",
      amount: "10000000000000000000",
    },
  ];
  const commitmentResult = await client.executeCommitmentSync(
    depositRecord.checkbookId,
    allocations,
    true
  );

  // Withdrawal
  const recipientInfo = {
    chain_id: 714,
    address: "0xRecipientAddress",
    amount: "10000000000000000000",
    token_symbol: "test_usdt",
  };
  const withdrawResult = await client.generateProofSync(
    depositRecord.checkbookId,
    recipientInfo,
    true
  );

  return { depositResult, commitmentResult, withdrawResult };
}
```

### Method 2: Convenient Methods

```javascript
async function convenientFlow() {
  const client = new ZKPayClient(config, logger);
  await client.initialize();
  await client.login(privateKey);

  // From deposit to commitment
  const allocations = [
    {
      recipient_chain_id: 714,
      recipient_address: "0xRecipientAddress",
      amount: "10000000000000000000",
    },
  ];

  const depositToCommitment = await client.performFullDepositToCommitment(
    714,
    "test_usdt",
    "10.0",
    allocations,
    { waitForCommitment: true }
  );

  // From commitment to withdrawal
  const recipientInfo = {
    chain_id: 714,
    address: "0xRecipientAddress",
    amount: "10000000000000000000",
    token_symbol: "test_usdt",
  };

  const commitmentToWithdraw = await client.performFullCommitmentToWithdraw(
    depositToCommitment.depositRecord.checkbook_id,
    recipientInfo,
    { waitForProof: true, maxWaitTime: 300 }
  );

  return { depositToCommitment, commitmentToWithdraw };
}
```

## üìä Status Flow

```
Deposit: pending ‚Üí detected ‚Üí ready_for_commitment ‚Üí with_checkbook ‚Üí issued
Commitment: ready_for_commitment ‚Üí submitting_commitment ‚Üí commitment_pending ‚Üí with_checkbook
Withdrawal: with_checkbook ‚Üí generating_proof ‚Üí proved ‚Üí completed
```

## üîß Core Interfaces

### Wallet Management

- `login(privateKey)`: Set user wallet
- `getCurrentUser()`: Get current user information

### Deposit Management

- `getTokenInfo(chainId, tokenContractAddress)`: Get token information (address, decimals, symbol, name)
- `checkTokenBalance(chainId, tokenContractAddress)`: Check balance (using token contract address)
- `checkTokenAllowance(chainId, tokenContractAddress, treasuryAddress)`: Check allowance (using token contract address)
- `approveToken(chainId, tokenAddress, amount, treasuryAddress)`: Approve token (using token address)
- `deposit(chainId, tokenAddress, amount, treasuryAddress)`: Execute deposit (using token address)
- `waitForDepositDetection(txHash, chainId, maxWaitTime)`: Wait for detection

### Commitment Management

- `getUserDeposits(userAddress?, chainId?)`: Get deposit records
- `getCheckbookDetails(checkbookId)`: Get CheckBook details
- `executeCommitmentSync(checkbookId, allocations, waitForWithCheck)`: Synchronously execute commitment
- `executeCommitmentAsync(checkbookId, allocations)`: Asynchronously execute commitment

### Withdrawal Management

- `generateProofSync(checkbookId, recipientInfo, waitForCompleted)`: Synchronously generate proof
- `generateProofAsync(checkbookId, recipientInfo)`: Asynchronously generate proof

### Convenient Methods

- `performFullDepositToCommitment(chainId, tokenSymbol, amount, allocations, options)`: Deposit to commitment
- `performFullCommitmentToWithdraw(checkbookId, recipientInfo, options)`: Commitment to withdrawal

## ‚öôÔ∏è Configuration Guide

### Complete Configuration Structure

```javascript
const config = {
  // 1. Service Configuration
  services: {
    zkpay_backend: {
      url: "https://backend.zkpay.network", // Required: ZKPay backend API address
      timeout: 300000, // Required: API request timeout (milliseconds)
    },
  },

  // 2. Blockchain Configuration
  blockchain: {
    // Source chain configuration array (management chain config removed, unified use of source_chains)
    source_chains: [
      {
        chain_id: 714, // Required: Source chain ID (SLIP44 BSC)
        rpc_url: "https://bsc-dataseed1.binance.org", // Required: RPC node address
        contracts: {
          treasury_contract: "0x83DCC14c8d40B87DE01cC641b655bD608cf537e8", // Required: Treasury contract address
        },
        tokens: {
          test_usdt: {
            // Token configuration
            address: "0xbFBD79DbF5369D013a3D31812F67784efa6e0309", // Required: Token contract address
            decimals: 6, // Required: Token decimals
            symbol: "TUSDT", // Required: Token symbol
            token_id: 65535, // Required: Token ID
          },
        },
      },
    ],
  },

  // 3. Runtime Configuration
  runtime: {
    withdraw: {
      default_recipient_address: "0x0848d929b9d35bfb7aa50641d392a4ad83e145ce", // Optional: Default recipient address
      max_wait_time: 300000, // Required: Maximum withdrawal wait time (milliseconds)
    },
    deposit: {
      confirmation_blocks: 3, // Required: Deposit confirmation blocks
    },
    proof_generation: {
      max_wait_time: 300000, // Required: Maximum proof generation wait time (milliseconds)
    },
  },

  // 4. Test Configuration (Optional)
  test: {
    users: {
      default: {
        private_key: "0x...", // Optional: Test user private key
      },
    },
  },
};
```

### Configuration Architecture Optimization Description

**Refactored Configuration Architecture Features:**

1. **Parameterized Passing**: ZKPayClient and all Managers use parameterized configuration, no longer dependent on complex config objects
2. **Responsibility Separation**: WalletManager handles RPC connections, other Managers handle business logic
3. **Configuration Simplification**: Removed management_chain configuration, unified use of parameterized Map structure
4. **Code Clarity**: Only one configuration method, avoiding compatibility confusion

**New Usage Method:**

```javascript
// Create parameterized configuration
const treasuryContracts = new Map([
  [56, "0x83DCC14c8d40B87DE01cC641b655bD608cf537e8"],
]);

// Token configuration: Only need to configure address, decimals and symbol are automatically read from contract
const tokenConfigs = new Map([
  ["56_test_usdt", "0xbFBD79DbF5369D013a3D31812F67784efa6e0309"],
]);

// Create client
const client = new ZKPayClient(logger, {
  apiConfig: {
    baseURL: "https://backend.zkpay.network",
    timeout: 300000,
  },
  treasuryContracts,
  tokenConfigs,
  confirmationBlocks: 3,
  maxWaitTime: 300000,
  defaultRecipientAddress: "0x0848d929b9d35bfb7aa50641d392a4ad83e145ce",
});
```

### ÊúÄÂ∞èÈÖçÁΩÆ

ÂØπ‰∫éÂü∫Êú¨ÂäüËÉΩÔºåÂè™ÈúÄË¶Å‰ª•‰∏ãÊúÄÂ∞èÈÖçÁΩÆÔºö

```javascript
const client = new ZKPayClient(logger, {
  apiConfig: {
    baseURL: "https://backend.zkpay.network",
    timeout: 300000,
  },
});
```

### ÈÖçÁΩÆÂ≠óÊÆµËØ¥Êòé

#### ÂøÖÈúÄÂ≠óÊÆµ

- `apiConfig.baseURL` - ZKPay ÂêéÁ´Ø API Âú∞ÂùÄ
- `apiConfig.timeout` - API ËØ∑Ê±ÇË∂ÖÊó∂Êó∂Èó¥

#### ÂèØÈÄâÂ≠óÊÆµ

- `treasuryContracts` - Treasury ÂêàÁ∫¶Âú∞ÂùÄ Map (chainId -> address)
- `tokenConfigs` - Token Âú∞ÂùÄ Map (chainId_symbol -> tokenAddress)
- `confirmationBlocks` - Â≠òÊ¨æÁ°ÆËÆ§Âå∫ÂùóÊï∞ (ÈªòËÆ§: 3)
- `maxWaitTime` - ÊúÄÂ§ßÁ≠âÂæÖÊó∂Èó¥ (ÈªòËÆ§: 300000ms)
- `defaultRecipientAddress` - ÈªòËÆ§Êé•Êî∂Âú∞ÂùÄ

#### Token ÈÖçÁΩÆËØ¥Êòé

Token ÈÖçÁΩÆÂè™ÈúÄË¶ÅÊèê‰æõÂêàÁ∫¶Âú∞ÂùÄÔºåÂÖ∂‰ªñ‰ø°ÊÅØÔºàdecimals„ÄÅsymbol„ÄÅnameÔºâ‰ºöËá™Âä®‰ªéÂêàÁ∫¶‰∏≠ËØªÂèñÔºö

**ÈÖçÁΩÆÊ†ºÂºè**Ôºö`slip44Id_symbol -> tokenAddress`

```javascript
const tokenConfigs = new Map([
  ["714_test_usdt", "0xbFBD79DbF5369D013a3D31812F67784efa6e0309"], // BSC‰∏äÁöÑÊµãËØïUSDT (SLIP44 714)
  ["60_usdt", "0xdAC17F958D2ee523a2206206994597C13D831ec7"], // Ethereum‰∏äÁöÑUSDT (SLIP44 60)
  ["966_usdc", "0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"], // Polygon‰∏äÁöÑUSDC (SLIP44 966)
  ["714_busd", "0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56"], // BSC‰∏äÁöÑBUSD (SLIP44 714)
  ["60_weth", "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"], // Ethereum‰∏äÁöÑWETH (SLIP44 60)
]);
```

**‰ºòÂäø**Ôºö

- ‚úÖ **ÁÆÄÂåñÈÖçÁΩÆ**ÔºöÂè™ÈúÄË¶ÅÈÖçÁΩÆÂêàÁ∫¶Âú∞ÂùÄ
- ‚úÖ **Ëá™Âä®Ëé∑Âèñ**Ôºödecimals„ÄÅsymbol„ÄÅname ‰ªéÂêàÁ∫¶Ëá™Âä®ËØªÂèñ
- ‚úÖ **ÈÅøÂÖçÈîôËØØ**Ôºö‰∏ç‰ºöÂõ†‰∏∫ÊâãÂä®ÈÖçÁΩÆ decimals ÂØºËá¥Á≤æÂ∫¶ÈîôËØØ
- ‚úÖ **ÊîØÊåÅ‰ªªÊÑè Token**ÔºöÂè™Ë¶ÅÊòØ ERC20 Ê†áÂáÜ Token ÈÉΩÂèØ‰ª•‰ΩøÁî®

### Initialization Example

```javascript
// Create parameterized configuration
const treasuryContracts = new Map([
  [714, "0x83DCC14c8d40B87DE01cC641b655bD608cf537e8"], // SLIP44 BSC
]);

const tokenConfigs = new Map([
  ["714_test_usdt", "0xbFBD79DbF5369D013a3D31812F67784efa6e0309"], // SLIP44 BSC
]);

// Initialize client
const client = new ZKPayClient(logger, {
  apiConfig: {
    baseURL: "https://backend.zkpay.network",
    timeout: 300000,
  },
  treasuryContracts,
  tokenConfigs,
  confirmationBlocks: 3,
  maxWaitTime: 300000,
});
await client.initialize();

// Login user (private key passed as parameter, not stored in configuration)
await client.login("0xYourPrivateKey");

// Usage example - All addresses passed directly
const tokenAddress = "0xbFBD79DbF5369D013a3D31812F67784efa6e0309";
const treasuryAddress = "0x83DCC14c8d40B87DE01cC641b655bD608cf537e8";
const amount = "10.0";

await client.deposit(714, tokenAddress, amount, treasuryAddress);
```

## üî¢ Âä®ÊÄÅËé∑Âèñ Token Decimals Á§∫‰æã

```javascript
// Ëé∑ÂèñToken‰ø°ÊÅØ
const tokenInfo = await client.getTokenInfo(
  714,
  "0xbFBD79DbF5369D013a3D31812F67784efa6e0309"
);
console.log(`Token: ${tokenInfo.symbol} (${tokenInfo.name})`);
console.log(`Decimals: ${tokenInfo.decimals}`);

// ‰ΩøÁî®Âä®ÊÄÅdecimalsËøõË°åÈáëÈ¢ùËÆ°ÁÆó
const amount = "10.0";
const amountWei = ethers.parseUnits(amount, tokenInfo.decimals);
console.log(`${amount} ${tokenInfo.symbol} = ${amountWei.toString()} Wei`);

// Ê£ÄÊü•‰ΩôÈ¢ùÊó∂‰ΩøÁî®Âä®ÊÄÅdecimals
const balance = await client.checkTokenBalance(714, tokenInfo.address);
console.log(`‰ΩôÈ¢ù: ${balance.formatted} ${tokenInfo.symbol}`);

// ÊéàÊùÉÊó∂‰ΩøÁî®Âä®ÊÄÅdecimals
if (balance.balance < amountWei) {
  console.log("‰ΩôÈ¢ù‰∏çË∂≥ÔºåÈúÄË¶ÅÂÖÖÂÄº");
} else {
  await client.approveToken(714, tokenInfo.address, amount, treasuryAddress);
}
```

## üåê RPC URL ÈÖçÁΩÆ

SDK ÊîØÊåÅ‰ªéÁéØÂ¢ÉÂèòÈáèËé∑Âèñ RPC URLÔºåÊàñ‰ΩøÁî®ÈªòËÆ§ÂÄºÔºö

### ÁéØÂ¢ÉÂèòÈáèÈÖçÁΩÆ

```bash
# Set specific chain RPC URL (using SLIP44 ID, SDK will automatically convert)
export RPC_URL_714=https://bsc-dataseed1.binance.org  # SLIP44 BSC
export RPC_URL_60=https://eth.llamarpc.com            # SLIP44 Ethereum
export RPC_URL_966=https://polygon-rpc.com            # SLIP44 Polygon

# Or use .env file
echo "RPC_URL_714=https://bsc-dataseed1.binance.org" >> .env
echo "RPC_URL_60=https://eth.llamarpc.com" >> .env

# Ê≥®ÊÑèÔºöÁéØÂ¢ÉÂèòÈáè‰ΩøÁî®EVM Chain IDÔºå‰ΩÜSDKÊîØÊåÅSLIP44 IDÊò†Â∞Ñ
# ‰æãÂ¶ÇÔºöSLIP44 714 (Tron) ‰ºöËá™Âä®Êò†Â∞ÑÂà∞ Chain ID 56 (BSC RPC)
```

### ÊîØÊåÅÁöÑÈìæÂíå SLIP44 Êò†Â∞Ñ

| SLIP44 ID | EVM Chain ID | ÈìæÂêçÁß∞            | ÈªòËÆ§ RPC URL                                   |
| --------- | ------------ | ----------------- | ---------------------------------------------- |
| 60        | 1            | Ethereum Mainnet  | https://eth.llamarpc.com                       |
| 60        | 3            | Ethereum Ropsten  | https://ropsten.infura.io/v3/                  |
| 60        | 4            | Ethereum Rinkeby  | https://rinkeby.infura.io/v3/                  |
| 60        | 5            | Ethereum Goerli   | https://goerli.infura.io/v3/                   |
| 60        | 42           | Ethereum Kovan    | https://kovan.infura.io/v3/                    |
| 60        | 11155111     | Ethereum Sepolia  | https://sepolia.infura.io/v3/                  |
| 714       | 56           | BSC Mainnet       | https://bsc-dataseed1.binance.org              |
| 714       | 97           | BSC Testnet       | https://data-seed-prebsc-1-s1.binance.org:8545 |
| 966       | 137          | Polygon Mainnet   | https://polygon-rpc.com                        |
| 966       | 80001        | Polygon Mumbai    | https://rpc-mumbai.maticvigil.com              |
| 42161     | 42161        | Arbitrum One      | https://arb1.arbitrum.io/rpc                   |
| 42161     | 421614       | Arbitrum Sepolia  | https://sepolia-rollup.arbitrum.io/rpc         |
| 10        | 10           | Optimism Mainnet  | https://mainnet.optimism.io                    |
| 10        | 420          | Optimism Sepolia  | https://sepolia.optimism.io                    |
| 250       | 250          | Fantom Mainnet    | https://rpc.ftm.tools                          |
| 250       | 4002         | Fantom Testnet    | https://rpc.testnet.fantom.network             |
| 60        | 25           | Cronos Mainnet    | https://evm.cronos.org                         |
| 60        | 338          | Cronos Testnet    | https://evm-t3.cronos.org                      |
| 1284      | 1284         | Moonbeam          | https://rpc.api.moonbeam.network               |
| 1284      | 1287         | Moonbase          | https://rpc.api.moonbase.moonbeam.network      |
| 60        | 43114        | Avalanche C-Chain | https://api.avax.network/ext/bc/C/rpc          |
| 60        | 43113        | Avalanche Fuji    | https://api.avax-test.network/ext/bc/C/rpc     |
| 100       | 100          | Gnosis Chain      | https://rpc.gnosischain.com                    |
| 100       | 10200        | Gnosis Chiado     | https://rpc.chiadochain.net                    |
| 195       | 195          | Tron Mainnet      | https://rpc.trongrid.io                        |
| 195       | 2494104990   | Tron Shasta       | https://api.shasta.trongrid.io                 |

### SLIP44 Êò†Â∞ÑËØ¥Êòé

SDK ÊîØÊåÅ SLIP44 Â∏ÅÁßç ID Âà∞ EVM Èìæ ID ÁöÑÊò†Â∞ÑÔºå‰∏ªË¶ÅÁâπÁÇπÔºö

- **SLIP44 60** ‚Üí **Chain ID 1** (Ethereum ‰∏ªÁΩë)
- **SLIP44 714** ‚Üí **Chain ID 56** (BSC ‰∏ªÁΩë)
- **SLIP44 966** ‚Üí **Chain ID 137** (Polygon ‰∏ªÁΩë)
- **SLIP44 42161** ‚Üí **Chain ID 42161** (Arbitrum One)
- **SLIP44 10** ‚Üí **Chain ID 10** (Optimism ‰∏ªÁΩë)
- **SLIP44 250** ‚Üí **Chain ID 250** (Fantom ‰∏ªÁΩë)
- **SLIP44 195** ‚Üí **Chain ID 195** (Tron ‰∏ªÁΩë)
- **ÂÖ∂‰ªñÈìæ**: Â§ßÈÉ®ÂàÜ SLIP44 ID ‰∏é EVM Chain ID Áõ∏ÂêåÔºåÊó†ÈúÄÊò†Â∞Ñ

**Usage Example:**

```javascript
// Use SLIP44 ID to access BSC
const provider = walletManager.getProvider(714); // SLIP44 BSC ID
const network = await provider.getNetwork(); // Returns Chain ID 56

// Use SLIP44 ID to access Ethereum
const provider = walletManager.getProvider(60); // SLIP44 Ethereum ID
const network = await provider.getNetwork(); // Returns Chain ID 1

// Use SLIP44 ID to access Polygon
const provider = walletManager.getProvider(966); // SLIP44 Polygon ID
const network = await provider.getNetwork(); // Returns Chain ID 137

// Use SLIP44 ID to access Tron
const provider = walletManager.getProvider(195); // SLIP44 Tron ID
const network = await provider.getNetwork(); // Returns Chain ID 195
```

## üîê KMS ÈõÜÊàê

zksdk ÊîØÊåÅ‰∏éÂ§ñÈÉ®ÂØÜÈí•ÁÆ°ÁêÜÁ≥ªÁªü(KMS)ÈõÜÊàêÔºåÂÆûÁé∞ÁßÅÈí•ÁöÑÂÆâÂÖ®ÁÆ°ÁêÜ„ÄÇÊîØÊåÅ SLIP44 Ê†áÂáÜÂíåÂ§öÁßçÁ≠æÂêçÁ±ªÂûãÔºö

### Âü∫Á°Ä KMS ÈõÜÊàê

```javascript
const { ZKPayClient } = require("zksdk");
const { ZKPayKMSSigner } = require("zksdk/utils/zkpay-kms-adapter");

// KMS configuration - using SLIP44 standard
const kmsConfig = {
  baseURL: "http://localhost:18082",
  keyAlias: "my_bsc_key",
  encryptedKey: "encrypted_private_key_from_kms",
  slip44Id: 714, // BSC uses SLIP44 ID 714
  address: "0x...",
  defaultSignatureType: "eip191", // BSC uses EIP-191 signature
};

// Create KMS signer
const kmsSigner = new ZKPayKMSSigner(kmsConfig);

// Login using KMS signer
const client = new ZKPayClient(config);
await client.loginWithSigner(kmsSigner, kmsConfig.address);
```

### SAAS KMS ÈõÜÊàê

ÂØπ‰∫é‰ºÅ‰∏öÁ∫ßÁî®Êà∑ÔºåÊîØÊåÅÈÄöËøá SAAS Á≥ªÁªüÁöÑ KMS ÊúçÂä°ËøõË°åÁ≠æÂêçÔºö

```javascript
const { SaasKMSSigner } = require("zksdk/utils/saas-kms-signer");

// SAAS KMSÈÖçÁΩÆ
const saasKmsConfig = {
  kmsUrl: "https://kms.your-saas.com",
  enterpriseId: "your_enterprise_id",
  chainId: 714, // BSC
  userAddress: "0x...",
  keyAlias: "enterprise_key",
  k1Key: "your_k1_key",
};

// ÂàõÂª∫SAAS KMSÁ≠æÂêçÂô®
const saasSigner = new SaasKMSSigner(saasKmsConfig);

// ‰ΩøÁî®SAAS KMSÁ≠æÂêçÂô®ÁôªÂΩï
await client.loginWithSigner(saasSigner, saasKmsConfig.userAddress);
```

### ÊîØÊåÅÁöÑÂå∫ÂùóÈìæÁΩëÁªú

| ÁΩëÁªú     | SLIP44 ID | Á≠æÂêçÁ±ªÂûã | ËØ¥Êòé          |
| -------- | --------- | -------- | ------------- |
| Ethereum | 60        | eip191   | ‰ª•Â§™Âùä‰∏ªÁΩë    |
| BSC      | 714       | eip191   | Â∏ÅÂÆâÊô∫ËÉΩÈìæ    |
| Tron     | 195       | tip191t  | Ê≥¢Âú∫ÁΩëÁªú      |
| Polygon  | 966       | eip191   | Polygon ÁΩëÁªú  |
| Arbitrum | 42161     | eip191   | Arbitrum One  |
| Optimism | 10        | eip191   | Optimism ÁΩëÁªú |

### Multi-chain KMS Usage Example

```javascript
// Â§öÈìæÁÆ°ÁêÜÂô®
const {
  MultiChainKMSManager,
} = require("zksdk/examples/multi-chain-kms-example");

const manager = new MultiChainKMSManager(
  {
    baseURL: "http://localhost:18082",
    keyAlias: "multi_chain",
  },
  logger
);

// Ê∑ªÂä†‰∏çÂêåÈìæÁöÑÈÖçÁΩÆ
manager.addChain("bsc", {
  slip44Id: 714,
  encryptedKey: "bsc_encrypted_key",
  address: "0xBSC_ADDRESS",
  defaultSignatureType: "eip191",
});

manager.addChain("tron", {
  slip44Id: 195,
  encryptedKey: "tron_encrypted_key",
  address: "TRON_ADDRESS",
  defaultSignatureType: "tip191t",
});

// Ë∑®ÈìæÁ≠æÂêç
await manager.signMessage("bsc", "Hello BSC!");
await manager.signMessage("tron", "Hello Tron!");
```

## üîí ÂÆâÂÖ®‰ΩøÁî®ÊåáÂçó

### ÁßÅÈí•ÁÆ°ÁêÜ

- ‚úÖ ‰ΩøÁî® KMS Á≥ªÁªüÁÆ°ÁêÜÁßÅÈí•ÔºàÊé®ËçêÔºâ
- ‚úÖ ‰ΩøÁî®ÁéØÂ¢ÉÂèòÈáèÂ≠òÂÇ®ÁßÅÈí•
- ‚úÖ ‰ΩøÁî®.env Êñá‰ª∂Ôºà‰∏çË¶ÅÊèê‰∫§Âà∞‰ª£Á†Å‰ªìÂ∫ìÔºâ
- ‚úÖ ÂÆöÊúüËΩÆÊç¢ÊµãËØïÁßÅÈí•
- ‚ùå Áªù‰∏çÂú®‰ª£Á†Å‰∏≠Á°¨ÁºñÁ†ÅÁßÅÈí•
- ‚ùå Áªù‰∏çÂú®ÂÖ¨ÂÖ±‰ªìÂ∫ì‰∏≠Êö¥Èú≤ÁßÅÈí•

### ÁéØÂ¢ÉÂèòÈáèËÆæÁΩÆ

```bash
# Set environment variable
export TEST_USER_PRIVATE_KEY=0xYourPrivateKey

# Or use .env file
echo "TEST_USER_PRIVATE_KEY=0xYourPrivateKey" > .env
```

### ÂÆâÂÖ®Ê£ÄÊü•Ê∏ÖÂçï

- [ ] ÊâÄÊúâÁßÅÈí•ÈÄöËøáÁéØÂ¢ÉÂèòÈáè‰º†ÈÄí
- [ ] ÈÖçÁΩÆÊñá‰ª∂‰∏≠Ê≤°ÊúâÁ°¨ÁºñÁ†ÅÁöÑÊïèÊÑü‰ø°ÊÅØ
- [ ] .env Êñá‰ª∂Âú® .gitignore ‰∏≠
- [ ] Âè™‰ΩøÁî®ÊµãËØïÁΩëÁªúÂíåÊµãËØïË¥¶Êà∑
- [ ] ÂÆöÊúüËΩÆÊç¢ÊµãËØïÁßÅÈí•

## üß™ ÊµãËØïÂíåÁ§∫‰æã

### ËøêË°åÊµãËØï

```bash
# ËøõÂÖ•examplesÁõÆÂΩï
cd examples

# ËøêË°åÂü∫Á°ÄÂäüËÉΩÊµãËØï
node quick-client-library-test.js

# ËøêË°åÂÆåÊï¥Á§∫‰æã
node zkpay-client-example.js --all

# ËøêË°åÁâπÂÆöÁ§∫‰æã
node zkpay-client-example.js --example example1
```

### ÊµãËØïËÑöÊú¨

- `test-simple-commitment.js`: ÁÆÄÂçïÊâøËØ∫ÊµãËØï
- `test-commitment-retry.js`: ÊâøËØ∫ÈáçËØïÊµãËØï
- `test-commitment-fixed.js`: ‰øÆÂ§çÁâàÊâøËØ∫ÊµãËØï
- `test-withdraw.js`: ÊèêÁé∞ÊµãËØï

## üéØ ‰ΩøÁî®Âª∫ËÆÆ

1. **ÂºÄÂèëÈò∂ÊÆµ**: ‰ΩøÁî®ÂàÜÊ≠•ÊâßË°åÔºå‰æø‰∫éË∞ÉËØï
2. **Áîü‰∫ßÁéØÂ¢É**: ‰ΩøÁî®‰æøÊç∑ÊñπÊ≥ïÔºåÁÆÄÂåñ‰ª£Á†Å
3. **ÈïøÊó∂Èó¥Êìç‰Ωú**: ‰ΩøÁî®ÂºÇÊ≠•ÊñπÂºèÔºåÈÅøÂÖçÈòªÂ°û
4. **Áä∂ÊÄÅÁõëÊéß**: ‰ΩøÁî® `checkStatus()`ÂÆûÊó∂ÁõëÊéßÁä∂ÊÄÅ

## üìù Ê≥®ÊÑè‰∫ãÈ°π

- **ÁßÅÈí•ÁÆ°ÁêÜ**: ÈÄöËøá Wallet Manager Áªü‰∏ÄÁÆ°ÁêÜÔºå‰∏Ä‰∏™ÁßÅÈí•ÂØπÂ∫î‰∏Ä‰∏™Èí±ÂåÖÂÆû‰æã
- **Êï∞ÊçÆÊ†ºÂºè**: ÈáëÈ¢ù‰ΩøÁî®Â≠óÁ¨¶‰∏≤Ê†ºÂºèÔºåÈÅøÂÖçÁ≤æÂ∫¶‰∏¢Â§±
- **Ë∂ÖÊó∂ËÆæÁΩÆ**: ÈïøÊó∂Èó¥Êìç‰ΩúÊúâÂêàÁêÜÁöÑË∂ÖÊó∂ËÆæÁΩÆ
- **ÈîôËØØÂ§ÑÁêÜ**: ÊâÄÊúâÊñπÊ≥ïÈÉΩÊúâÂÆåÊï¥ÁöÑÈîôËØØÂ§ÑÁêÜÂíåÊó•ÂøóËÆ∞ÂΩï
- **Áä∂ÊÄÅÊ£ÄÊü•**: Êìç‰ΩúÂâçÊ£ÄÊü•Áõ∏ÂÖ≥Áä∂ÊÄÅÔºåÁ°Æ‰øùÊµÅÁ®ãÊ≠£Á°Æ
- **API ËÆæËÆ°Áªü‰∏Ä**:
  - ÊâÄÊúâÊñπÊ≥ïÈÉΩ‰ΩøÁî® Token ÂêàÁ∫¶Âú∞ÂùÄÔºåÁ°Æ‰øù API ‰∏ÄËá¥ÊÄß
  - ‰∏çÂÜç‰æùËµñ config.yaml ÈÖçÁΩÆÊñá‰ª∂ÔºåÊâÄÊúâÂèÇÊï∞Áõ¥Êé•‰º†ÂÖ•
  - ÊîØÊåÅ‰ªªÊÑè Token ÂêàÁ∫¶ÔºåÊó†ÈúÄÈ¢ÑÈÖçÁΩÆ
- **Âä®ÊÄÅËé∑Âèñ Token ‰ø°ÊÅØ**:
  - ‰ΩøÁî® `getTokenInfo()`ÊñπÊ≥ïÂä®ÊÄÅËé∑Âèñ Token ÁöÑ decimals„ÄÅsymbol„ÄÅname
  - ‰∏çÂÜçÁ°¨ÁºñÁ†Å decimalsÔºåÁ°Æ‰øùÁ≤æÂ∫¶ËÆ°ÁÆóÁöÑÂáÜÁ°ÆÊÄß
  - ÊîØÊåÅ‰ªªÊÑè ERC20 TokenÔºåËá™Âä®ÈÄÇÈÖçÂÖ∂Á≤æÂ∫¶

## üîÑ Relationship with Existing Code

This library is built on top of existing E2E automation code:

- **Reuse**: Fully reuses existing manager classes
- **Enhancement**: Added unified client interface
- **Integration**: Uses CommitmentManager internal signing methods
- **Extension**: Provides both synchronous/asynchronous operation modes

## üì¶ Dependencies

- `ethers` - Ethereum interaction
- `axios` - HTTP requests
- `dotenv` - Environment variable management
- Existing logger and manager components

## üîó Related Files

- Original E2E test: `../zkpay-e2e-test.js`
- Logging utility: `../logger.js`
- Usage example: `examples/zkpay-client-example.js`
